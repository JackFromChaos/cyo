<html>
<title>CYO - The Choose Your Own Adventure Framework</title>
<script src='lib/angular/angular.min.js'></script>
<script src='lib/underscore.js'></script>
<script src='lib/underscore/underscore.string.js'></script>
<!-- <script src='lib/jquery/dist/jquery-2.0.3.js'></script> -->
<script src='js/cyo.js'></script>


<body class='container' ng-app="cyo2">
    <h1>CYO2</h1>

    <story>
        <page intro>
          {{quoi}}
            Wow! What a great new format.
            <choice go>Time to go!</choice>
            <choice stay>Time to stay!</choice>
        </page>
        <page go>
            Ho ho! Now I go!
            <event went></event>
            <choice next-zone>The next zone?</choice>
        </page>
        <page stay>
            Hey hey! Think I'll stay!
            <choice next-zone>The next zone, then.</choice>
        </page>
        <page next-zone>
            You arrive in the next zone.
            <condition went>
                Glad I went.
            </condition>
        </page>
    </story>


</body>
<script>
angular.module("cyo2", [])
    .directive("story", function() {
        return {
            restrict: "EA",
            controller: "StoryController",
        }
    })
    .directive("page", function() {
        return {
            restrict: "EA",
            controller: "PageController",
        }
    })
    .directive("event", function() {
        return {
            restrict: "EA",
            controller: "EventController",
        }
    })


    .controller("StoryController", function($scope) {
        $scope.events = [];
        $scope.pages = {};
        $scope.registerPage = function(name,controller) {
            $scope.pages[name] = controller;
            controller.hide();
        };

        $scope.$watch("pages",function(){
          console.log("pages changed");
          // $scope.pages.forEach(function(page,title){
            // if (title == "intro") page.show();
          // })

          for (var title in $scope.pages) {
            var page = $scope.pages[title];
            if (title == "intro") page.show();
          }
        })
    })

    .controller("PageController", function($scope, $attrs,$element) {
        var pageName = Object.keys($attrs.$attr)[0];
        this.show = function() {
          $element.attr("style","display:block");
        };
        this.hide = function() {
          $element.attr("style","display:none");
        }
        $scope.registerPage(pageName,this);
    })
    .controller("EventController", function($scope, eventService,$attrs) {
      var events = Object.keys($attrs.$attr);
      var isNegative = false;
      if (events[0] === "clear") {
        isNegative = true;
        events.shift();
      };

      eventService[(!isNegative) ? "add" : "remove"](events[0]);
    })
    
    .service("eventService", function() {
      this.events = {};

      this.add = function(event) {
        this.events[event] = event;
      };

      this.remove = function(event) {
        delete this.events[event];
      }
    })
</script>
<style>
page,
story,
choice {
    display: block;
    border: 1px solid black;
}
choice {
    display: block;
    border-style: solid;
    border-color: #bbb #888 #666 #aaa;
    border-width: 3px 4px 4px 3px;
    width: 9em;
    margin: 5px;
    height: 2em;
    background: #ccc;
    color: #333;
    line-height: 2;
    text-align: center;
    text-decoration: none;
    font-weight: 900;
    transition: 0.2s all;
    cursor: pointer;
}
choice:hover {
    border-color: #666 #aaa #bbb #888;
    border-width: 4px 3px 3px 4px;
    color: #000;
}
page {
    display: none;
}
page:first-child {
    display: block;
}
;
</style>

</html>
